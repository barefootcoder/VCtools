#! /usr/bin/perl

use strict;
use warnings;

use VCtools::Base;
use VCtools::Args;
use VCtools::Common;


#################################
# OPTIONS AND ENVIRONMENT VARS
#################################

VCtools::switch('latest', 'l', 'show only latest log');
VCtools::args('files', 'list', 'file(s) (or directory/ies) to show logs for');
VCtools::getopts();

# remember, directories are files too
my @files = VCtools::files();
print STDERR "log for files: @files\n" if DEBUG >= 3;


#################################
# CHECK FOR ERRORS
#################################

VCtools::verify_files_and_group(@files);

# get statuses for everything at once (quicker that way)
VCtools::cache_file_status(@files, { DONT_RECURSE => 1 });

foreach my $file (@files)
{
	VCtools::fatal_error("$file is not in VC") unless VCtools::exists_in_vc($file);
}


#################################
# MAIN
#################################

my $count = @files;
foreach (@files)
{
	my $header_line = @files > 1 ? "\n---> $_ <---\n" : "";

	if (VCtools::latest())
	{
		my @log_lines = VCtools::get_log($_);
		print $header_line, shift @log_lines;
		/^\n/ ? last : print foreach @log_lines;
	}
	else
	{
		VCtools::page_output('.vclog', $header_line, VCtools::get_log($_));
		print "\n";
		VCtools::prompt_to_continue("$count more files to view") if --$count;
	}
}

print "\ndone\n";


#################################
# SUBS
#################################
